package com.example.chaatralay.Activities;import androidx.appcompat.app.AppCompatActivity;import android.app.ProgressDialog;import android.content.Context;import android.content.Intent;import android.content.SharedPreferences;import android.os.Bundle;import android.util.Log;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.RadioButton;import android.widget.RadioGroup;import android.widget.Toast;import com.android.volley.AuthFailureError;import com.android.volley.Request;import com.android.volley.RequestQueue;import com.android.volley.Response;import com.android.volley.VolleyError;import com.android.volley.toolbox.StringRequest;import com.android.volley.toolbox.Volley;import com.example.chaatralay.Includes.Constants;import com.example.chaatralay.R;import org.json.JSONException;import org.json.JSONObject;import java.util.HashMap;import java.util.Map;public class MainActivity extends AppCompatActivity {    private static final String TAG = "MainActivity";    private RadioGroup radioGroup;    private RadioButton radioButton;    private Button loginBtn,registerhereBtn;    private EditText usernameEt,passwordEt;    private ProgressDialog progressDialog;    private String userType,username,password,sid,course,jsonvalue,user,pass,shared_preference_user,shared_preference_pass;    public static final String MyPreferences="MyPrefs";    private int id;    private SharedPreferences sharedPreferences;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        radioGroup = findViewById(R.id.optionRg);        loginBtn = findViewById(R.id.loginBtn);        registerhereBtn = findViewById(R.id.registerhereBtn);        usernameEt = findViewById(R.id.usernameEt);        passwordEt = findViewById(R.id.passwordEt);        progressDialog=new ProgressDialog(this);        registerhereBtn.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                Intent i =new Intent(getApplicationContext(), EmailVerification.class);                startActivity(i);            }        });        loginBtn.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                int selectedId = 0;                selectedId = radioGroup.getCheckedRadioButtonId();                radioButton = findViewById(selectedId);                userType = radioButton.getText().toString();                Toast.makeText(MainActivity.this, "hiiii"+userType, Toast.LENGTH_SHORT).show();                username = usernameEt.getText().toString().trim();                password=passwordEt.getText().toString().trim();                user=username;                pass=password;                studentLogin();            }        });    }    private void studentLogin() {        progressDialog.setMessage("Please wait...");        progressDialog.show();        Log.d(TAG, "onCreate: test 3" );        StringRequest request = new StringRequest(Request.Method.POST, Constants.LOGIN_USER, new Response.Listener<String>() {            @Override            public void onResponse(String response) {//                Toast.makeText(MainActivity.this, "inside", Toast.LENGTH_SHORT).show();                progressDialog.dismiss();                Log.d(TAG, "onCreate:sd " + response );//                JSONObject jsonObject = new JSONObject(response);                try {                    JSONObject jsonObject = new JSONObject(response);                    Log.d(TAG, "onCreate:sd " + response+jsonObject.getString("id"));                    sid=jsonObject.getString("id");                    jsonvalue=jsonObject.getString("message");                    Log.d(TAG, "onCreate: "+userType);                    if(userType.equals("Teachers"))                    {                        Log.d(TAG, "onCreate: entered teacher");                        course=jsonObject.getString("course");                        Log.d(TAG, "onCreate: "+course);                    }                    Toast.makeText(MainActivity.this, jsonObject.getString("message"), Toast.LENGTH_SHORT).show();                    switch (userType){                        case "Principle":                            Log.d(TAG,"Principle");                            if((jsonvalue+" "+userType).equals("Welcome"+" "+"Principle"))                            {                                startSession(username, userType);                                Intent i=new Intent(getApplicationContext(), Dashboard.class);                                i.putExtra("id",sid);                                i.putExtra("userType",userType);                                startActivity(i);                            }else {                                Toast.makeText(MainActivity.this, "user not registered", Toast.LENGTH_SHORT).show();                            }                            break;                        case "Warden":                            if((jsonvalue+" "+userType).equals("Welcome"+" "+"Warden"))                            {                                startSession(username, userType);                                Intent i=new Intent(getApplicationContext(), Dashboard.class);                                i.putExtra("id",sid);                                i.putExtra("userType",userType);                                startActivity(i);                            }else {                                Toast.makeText(MainActivity.this, "user not registered", Toast.LENGTH_SHORT).show();                            }//                            Toast.makeText(MainActivity.this, "war", Toast.LENGTH_SHORT).show();                            break;                        case "Student":                            if((jsonvalue+" "+userType).equals("Welcome"+" "+"Student"))                            {                                startSession(username, userType);                                Intent i=new Intent(getApplicationContext(), Dashboard.class);                                i.putExtra("id",sid);                                i.putExtra("userType",userType);                                startActivity(i);                            }else {                                Toast.makeText(MainActivity.this, "user not registered", Toast.LENGTH_SHORT).show();                            }                            break;                        case "Swo":                            if((jsonvalue+" "+userType).equals("Welcome"+" "+"Swo"))                            {                                startSession(username, userType);                                Intent i=new Intent(getApplicationContext(), Dashboard.class);                                i.putExtra("id",sid);                                i.putExtra("userType",userType);                                startActivity(i);                            }else {                                Toast.makeText(MainActivity.this, "user not registered", Toast.LENGTH_SHORT).show();                            }//                            Toast.makeText(MainActivity.this, "sw", Toast.LENGTH_SHORT).show();                            break;                        case "Teachers":                            Log.d(TAG,"Teachers");                            if((jsonvalue+" "+userType).equals("Welcome"+" "+"Teachers"))                            {                                startSession(username, userType);//                                course=jsonObject.getString("course");                                Log.d(TAG, "onCreate: "+course);                                Intent i=new Intent(getApplicationContext(), Dashboard.class);                                i.putExtra("id",sid);                                i.putExtra("course",course);                                i.putExtra("userType",userType);                                startActivity(i);                            }else {                                Toast.makeText(MainActivity.this, "user not registered", Toast.LENGTH_SHORT).show();                            }                            break;                    }                } catch (JSONException e) {                    Toast.makeText(MainActivity.this, "hii"+e.toString(), Toast.LENGTH_SHORT).show();                    Log.d(TAG, "onCreate:sd " +e.toString() );                }            }        }, new Response.ErrorListener() {            @Override            public void onErrorResponse(VolleyError error) {                Log.d(TAG, "onCreate: test 5"+ error.getMessage() );                progressDialog.hide();                Toast.makeText(MainActivity.this, "ERROR: " + error.getMessage(), Toast.LENGTH_SHORT).show();            }        }){            @Override            protected Map<String, String> getParams() throws AuthFailureError {                Map<String, String> params = new HashMap<>();                Log.d(TAG,"onCreate: string"+username+password);                params.put("username", username);                params.put("password", password);                params.put("usertype",userType);                return params;            }        };        Log.d(TAG, "onCreate: test 6" );        RequestQueue requestQueue = Volley.newRequestQueue(this);        request.setShouldCache(false);        requestQueue.add(request);        Log.d(TAG, "onCreate: test 7" );    }    private void startSession(String username, String userType){        SharedPreferences.Editor editor = sharedPreferences.edit();        editor.putString("username", username);        editor.putString("userType", userType);        editor.putString("id", sid);        editor.putString("course",course);        editor.commit();    }    @Override    protected void onStart() {        super.onStart();        sharedPreferences = getSharedPreferences(MyPreferences, Context.MODE_PRIVATE);        Log.d(TAG, "onStart: started " + sharedPreferences.getString("userType", "not present"));        if(!sharedPreferences.getString("username", "null").equals("null") && !sharedPreferences.getString("userType", "null").equals("null")){            Log.d(TAG, "onStart: entered if " );//            if(sharedPreferences.getString("userType", null).equals("Principle")){//                Log.d(TAG, "onStart: entered if");//                Log.d(TAG, "onStart: " + sharedPreferences.getString("userType", null));//                Intent i=new Intent(getApplicationContext(),Dashboard.class);//                i.putExtra("id",sharedPreferences.getString("id",null));//                i.putExtra("userType",sharedPreferences.getString("userType",null));//                startActivity(i);//                finish();//            }else if(sharedPreferences.getString("userType", null).equals("Swo")){//                Log.d(TAG, "onStart: entered if");//                Log.d(TAG, "onStart: " + sharedPreferences.getString("userType", null));//                Intent i=new Intent(getApplicationContext(),Dashboard.class);//                i.putExtra("id",sharedPreferences.getString("id",null));//                i.putExtra("userType",sharedPreferences.getString("userType",null));//                startActivity(i);//                finish();//            }else if(sharedPreferences.getString("userType", null).equals("Warden")){//                Log.d(TAG, "onStart: entered if");//                Log.d(TAG, "onStart: " + sharedPreferences.getString("userType", null));//                Intent i=new Intent(getApplicationContext(),Dashboard.class);//                i.putExtra("id",sharedPreferences.getString("id",null));//                i.putExtra("userType",sharedPreferences.getString("userType",null));//                startActivity(i);////                finish();//            }else if(sharedPreferences.getString("userType", null).equals("Student")){//                Log.d(TAG, "onStart: entered if");//                Log.d(TAG, "onStart: " + sharedPreferences.getString("userType", null));//                Intent i=new Intent(getApplicationContext(),Dashboard.class);//                i.putExtra("id",sharedPreferences.getString("id",null));//                i.putExtra("userType",sharedPreferences.getString("userType",null));//                startActivity(i);////                startActivity(new Intent(MainActivity.this, Dashboard.class));//                finish();//            }            if(sharedPreferences.getString("userType", null).equals("Teachers")) {                Log.d(TAG, "onStart: entered if");                Log.d(TAG, "onStart: " + sharedPreferences.getString("userType", null));                Intent i = new Intent(getApplicationContext(), Dashboard.class);                i.putExtra("id", sharedPreferences.getString("id", null));                i.putExtra("userType", sharedPreferences.getString("userType", null));                i.putExtra("course", sharedPreferences.getString("course", null));                startActivity(i);                finish();            }else {                Intent i=new Intent(getApplicationContext(), Dashboard.class);                i.putExtra("id",sharedPreferences.getString("id",null));                i.putExtra("userType",sharedPreferences.getString("userType",null));                startActivity(i);                finish();            }        }    }}